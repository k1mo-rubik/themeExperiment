<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}">
  <title>Админка</title>
  <style>
    .correct-row {
      background-color: #d4edda; /* светло-зеленый фон */
    }
    .incorrect-row {
      background-color: #f8d7da; /* светло-красный фон */
    }
    .table-container {
      overflow-x: auto;
    }
    /* Стили для модального окна */
    .modal {
      display: none; /* Скрыто по умолчанию */
      position: fixed; /* Оставаться на месте */
      z-index: 1; /* Поверх всего */
      padding-top: 100px; /* Расстояние сверху */
      left: 0;
      top: 0;
      width: 100%; /* Полная ширина */
      height: 100%; /* Полная высота */
      overflow: auto; /* Включить прокрутку, если нужно */
      background-color: rgb(0,0,0); /* Фон */
      background-color: rgba(0,0,0,0.4); /* Фон с прозрачностью */
    }

    /* Стиль модального содержимого */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }

    /* Стиль кнопки закрытия */
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div style="margin: 0 15%; text-align:center;">
  <h1 class="mb-4">Результаты пользователей</h1>
  <div class="table-container">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
      <tr>
        <th>Пользователь</th>
        <th>Пол</th>
        <th>Возраст</th>
        <th>Всего Правильных</th>
        <th>Суммарно (светлая тема)</th>
        <th>Суммарно (тёмная тема)</th>
        <th>Эксперимент завершен</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user : ${users}"
          th:class="${totalCorrectAnswersMap[user.id] >= 3} ? 'correct-row' : 'incorrect-row'"
          th:data-feedback="${feedbackMap[user.id]?.feedbackText}"
          style="cursor: pointer;">
        <td th:text="${user.nickname}"></td>
        <td th:text="${user.gender}"></td>
        <td th:text="${user.age}"></td>
        <td th:text="${totalCorrectAnswersMap[user.id]}"></td>
        <td th:text="${lightAnswersMap[user.id] != null ? lightAnswersMap[user.id] : 0}"></td>
        <td th:text="${darkAnswersMap[user.id] != null ? darkAnswersMap[user.id] : 0}"></td>
        <td th:text="${feedbackMap.containsKey(user.id) ? 'Да' : 'Нет'}"></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Модальное окно -->
<div id="feedbackModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Фидбэк пользователя</h2>
    <p id="feedbackText"></p>
  </div>
</div>

<script>
  // Получаем модальное окно
  var modal = document.getElementById("feedbackModal");

  // Получаем элемент <span>, который закрывает модальное окно
  var span = document.getElementsByClassName("close")[0];

  // Получаем все строки таблицы
  var rows = document.querySelectorAll("table tbody tr");

  rows.forEach(function(row) {
    row.addEventListener("click", function() {
      var feedback = this.getAttribute("data-feedback");
      if (feedback) {
        document.getElementById("feedbackText").innerText = feedback;
        modal.style.display = "block";
      }
    });
  });

  // Когда пользователь нажимает на <span> (x), закрыть модальное окно
  span.onclick = function() {
    modal.style.display = "none";
  }

  // Когда пользователь кликает вне модального окна, закрыть его
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>
</body>
</html>
